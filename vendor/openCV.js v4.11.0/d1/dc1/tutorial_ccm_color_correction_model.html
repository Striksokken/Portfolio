<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenCV: Color Correction Model</title>
<link rel="icon" href="../../opencv.ico" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  loader: {
    load: ['[tex]/ams']
  },
  tex: {
    macros: {},
    packages: ['base','configmacros','ams']
  }
};
//<![CDATA[
window.MathJax = {
    loader: {load: ['[tex]/ams']},
    tex: {
        packages: {'[+]': ['ams']},
        macros: {
            matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
            fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
            forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
            forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
            vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
            vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
            cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
            distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
            distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
            hdotsfor: ["\\dots", 1],
            mathbbm: ["\\mathbb{#1}", 1],
            bordermatrix: ["\\matrix{#1}", 1]
        },
        processEscapes: false
    }
};
//]]>
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td id="projectalign">
   <div id="projectname">OpenCV<span id="projectnumber">&#160;4.11.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d3/d81/tutorial_contrib_root.html">Tutorials for contrib modules</a></li><li class="navelem"><a class="el" href="../../db/db3/tutorial_table_of_content_ccm.html">Color Correction Model</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Color Correction Model</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2build_24__x-contrib__docs-lin64_2opencv__contrib_2modules_2mcc_2tutorials_2basic__ccm_2color__correction__model"></a></p>
<p>In this tutorial you will learn how to use the 'Color Correction Model' to do a color correction in a image.</p>
<h1><a class="anchor" id="autotoc_md1932"></a>
Reference</h1>
<p>See details of ColorCorrection Algorithm at <a href="https://github.com/riskiest/color_calibration/tree/v4/doc/pdf/English/Algorithm">https://github.com/riskiest/color_calibration/tree/v4/doc/pdf/English/Algorithm</a></p>
<h1><a class="anchor" id="autotoc_md1933"></a>
Building</h1>
<p>When building OpenCV, run the following command to build all the contrib modules:</p>
<div class="fragment"><div class="line">cmake -D OPENCV_EXTRA_MODULES_PATH=&lt;opencv_contrib&gt;/modules/</div>
</div><!-- fragment --><p>Or only build the mcc module:</p>
<div class="fragment"><div class="line">cmake -D OPENCV_EXTRA_MODULES_PATH=&lt;opencv_contrib&gt;/modules/mcc</div>
</div><!-- fragment --><p>Or make sure you check the mcc module in the GUI version of CMake: cmake-gui.</p>
<h1><a class="anchor" id="autotoc_md1934"></a>
Source Code of the sample</h1>
<p>The sample has two parts of code, the first is the color checker detector model, see details at <a class="el" href="../../d9/d7e/tutorial_mcc_basic_chart_detection.html">Detecting colorcheckers using basic algorithms</a>, the second part is to make collor calibration.</p>
<div class="fragment"><div class="line">Here are the parameters for ColorCorrectionModel</div>
<div class="line">    src :</div>
<div class="line">            detected colors of ColorChecker patches;</div>
<div class="line">            NOTICE: the color type is RGB not BGR, and the color values are in [0, 1];</div>
<div class="line">    constcolor :</div>
<div class="line">            the Built-in color card;</div>
<div class="line">            Supported list:</div>
<div class="line">                Macbeth: Macbeth ColorChecker ;</div>
<div class="line">                Vinyl: DKK ColorChecker ;</div>
<div class="line">                DigitalSG: DigitalSG ColorChecker with 140 squares;</div>
<div class="line">    Mat colors :</div>
<div class="line">           the reference color values</div>
<div class="line">           and corresponding color space</div>
<div class="line">           NOTICE: the color values are in [0, 1]</div>
<div class="line">    ref_cs :</div>
<div class="line">           the corresponding color space</div>
<div class="line">                  If the color type is some RGB, the format is RGB not BGR;</div>
<div class="line">    Supported Color Space:</div>
<div class="line">            Supported list of RGB color spaces:</div>
<div class="line">                COLOR_SPACE_sRGB;</div>
<div class="line">                COLOR_SPACE_AdobeRGB;</div>
<div class="line">                COLOR_SPACE_WideGamutRGB;</div>
<div class="line">                COLOR_SPACE_ProPhotoRGB;</div>
<div class="line">                COLOR_SPACE_DCI_P3_RGB;</div>
<div class="line">                COLOR_SPACE_AppleRGB;</div>
<div class="line">                COLOR_SPACE_REC_709_RGB;</div>
<div class="line">                COLOR_SPACE_REC_2020_RGB;</div>
<div class="line">            Supported list of linear RGB color spaces:</div>
<div class="line">                COLOR_SPACE_sRGBL;</div>
<div class="line">                COLOR_SPACE_AdobeRGBL;</div>
<div class="line">                COLOR_SPACE_WideGamutRGBL;</div>
<div class="line">                COLOR_SPACE_ProPhotoRGBL;</div>
<div class="line">                COLOR_SPACE_DCI_P3_RGBL;</div>
<div class="line">                COLOR_SPACE_AppleRGBL;</div>
<div class="line">                COLOR_SPACE_REC_709_RGBL;</div>
<div class="line">                COLOR_SPACE_REC_2020_RGBL;</div>
<div class="line">            Supported list of non-RGB color spaces:</div>
<div class="line">                COLOR_SPACE_Lab_D50_2;</div>
<div class="line">                COLOR_SPACE_Lab_D65_2;</div>
<div class="line">                COLOR_SPACE_XYZ_D50_2;</div>
<div class="line">                COLOR_SPACE_XYZ_D65_2;</div>
<div class="line">                COLOR_SPACE_XYZ_D65_10;</div>
<div class="line">                COLOR_SPACE_XYZ_D50_10;</div>
<div class="line">                COLOR_SPACE_XYZ_A_2;</div>
<div class="line">                COLOR_SPACE_XYZ_A_10;</div>
<div class="line">                COLOR_SPACE_XYZ_D55_2;</div>
<div class="line">                COLOR_SPACE_XYZ_D55_10;</div>
<div class="line">                COLOR_SPACE_XYZ_D75_2;</div>
<div class="line">                COLOR_SPACE_XYZ_D75_10;</div>
<div class="line">                COLOR_SPACE_XYZ_E_2;</div>
<div class="line">                COLOR_SPACE_XYZ_E_10;</div>
<div class="line">                COLOR_SPACE_Lab_D65_10;</div>
<div class="line">                COLOR_SPACE_Lab_D50_10;</div>
<div class="line">                COLOR_SPACE_Lab_A_2;</div>
<div class="line">                COLOR_SPACE_Lab_A_10;</div>
<div class="line">                COLOR_SPACE_Lab_D55_2;</div>
<div class="line">                COLOR_SPACE_Lab_D55_10;</div>
<div class="line">                COLOR_SPACE_Lab_D75_2;</div>
<div class="line">                COLOR_SPACE_Lab_D75_10;</div>
<div class="line">                COLOR_SPACE_Lab_E_2;</div>
<div class="line">                COLOR_SPACE_Lab_E_10;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1935"></a>
Code</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/d9c/core_2include_2opencv2_2core_8hpp.html">opencv2/core.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d4/dd5/highgui_8hpp.html">opencv2/highgui.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d87/imgcodecs_8hpp.html">opencv2/imgcodecs.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/d35/mcc_8hpp.html">opencv2/mcc.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d75/namespacecv.html">cv</a>;</div>
<div class="line"><span class="keyword">using namespace </span>mcc;</div>
<div class="line"><span class="keyword">using namespace </span>ccm;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d8/dcc/namespacestd.html">std</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *about = <span class="stringliteral">&quot;Basic chart detection&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *keys =</div>
<div class="line">    <span class="stringliteral">&quot;{ help h  |    | show this message }&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{t        |      |  chartType: 0-Standard, 1-DigitalSG, 2-Vinyl }&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{v        |      | Input from video file, if ommited, input comes from camera }&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{ci       | 0    | Camera id if input doesnt come from video (-v) }&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{f        | 1    | Path of the file to process (-v) }&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;{nc       | 1    | Maximum number of charts in the image }&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="../../dc/d89/highgui__qt_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ----------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Scroll down a bit (~40 lines) to find actual relevant code</span></div>
<div class="line">    <span class="comment">// ----------------------------------------------------------</span></div>
<div class="line">    <a class="code hl_class" href="../../d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser(argc, argv, keys);</div>
<div class="line">    parser.about(about);</div>
<div class="line">    <span class="keywordflow">if</span> (argc==1 || parser.has(<span class="stringliteral">&quot;help&quot;</span>))</div>
<div class="line">    {</div>
<div class="line">        parser.printMessage();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> t = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;t&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> nc = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;nc&quot;</span>);</div>
<div class="line">    <span class="keywordtype">string</span> filepath = parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;f&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="../../db/de0/group__core__utils.html#gaf62bcd90f70e275191ab95136d85906b">CV_Assert</a>(0 &lt;= t &amp;&amp; t &lt;= 2);</div>
<div class="line">    <a class="code hl_enumeration" href="../../dd/d19/group__mcc.html#ga836ee96afcefd4f35e95760ca9e8163d">TYPECHART</a> chartType = <a class="code hl_enumeration" href="../../dd/d19/group__mcc.html#ga836ee96afcefd4f35e95760ca9e8163d">TYPECHART</a>(t);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!parser.check())</div>
<div class="line">    {</div>
<div class="line">        parser.printErrors();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> image = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gacbaa02cffc4ec2422dfa2e24412a99e2">imread</a>(filepath, IMREAD_COLOR);</div>
<div class="line">    <span class="keywordflow">if</span> (!image.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">data</a>)</div>
<div class="line">    {</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Invalid Image!&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> imageCopy = image.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>();</div>
<div class="line">    <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga524e5e94ebf48db273a71ab275eaf5b5">Ptr&lt;CCheckerDetector&gt;</a> detector = CCheckerDetector::create();</div>
<div class="line">    <span class="comment">// Marker type to detect</span></div>
<div class="line">    <span class="keywordflow">if</span> (!detector-&gt;process(image, chartType, nc))</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;ChartColor not detected \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 2;</div>
<div class="line">    }</div>
<div class="line">    vector&lt;Ptr&lt;mcc::CChecker&gt;&gt; checkers = detector-&gt;getListColorChecker();</div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga524e5e94ebf48db273a71ab275eaf5b5">Ptr&lt;mcc::CChecker&gt;</a> checker : checkers)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga524e5e94ebf48db273a71ab275eaf5b5">Ptr&lt;CCheckerDraw&gt;</a> cdraw = CCheckerDraw::create(checker);</div>
<div class="line">        cdraw-&gt;draw(image);</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> chartsRGB = checker-&gt;getChartsRGB();</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> src = chartsRGB.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a23df02a07ffbfa4aa59c19bc003919fe">col</a>(1).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>().<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4eb96e3251417fa88b78e2abd6cfd7d8">reshape</a>(3, chartsRGB.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>/3);</div>
<div class="line">        src /= 255.0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//compte color correction matrix</span></div>
<div class="line">        ColorCorrectionModel model1(src, COLORCHECKER_Vinyl);</div>
<div class="line">        model1.run();</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> ccm = model1.getCCM();</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;ccm &quot;</span>&lt;&lt;ccm&lt;&lt;std::endl;</div>
<div class="line">        <span class="keywordtype">double</span> loss = model1.getLoss();</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;loss &quot;</span>&lt;&lt;loss&lt;&lt;std::endl;</div>
<div class="line">         <span class="comment">/* brief More models with different parameters, try it &amp; check the document for details.</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">        <span class="comment">// model1.setColorSpace(COLOR_SPACE_sRGB);</span></div>
<div class="line">        <span class="comment">// model1.setCCM_TYPE(CCM_3x3);</span></div>
<div class="line">        <span class="comment">// model1.setDistance(DISTANCE_CIE2000);</span></div>
<div class="line">        <span class="comment">// model1.setLinear(LINEARIZATION_GAMMA);</span></div>
<div class="line">        <span class="comment">// model1.setLinearGamma(2.2);</span></div>
<div class="line">        <span class="comment">// model1.setLinearDegree(3);</span></div>
<div class="line">        <span class="comment">// model1.setSaturatedThreshold(0, 0.98);</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* If you use a customized ColorChecker, you can use your own reference color values and corresponding color space in a way like:</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">        <span class="comment">// cv::Mat ref = (Mat_&lt;Vec3d&gt;(18, 1) &lt;&lt;</span></div>
<div class="line">        <span class="comment">// Vec3d(100, 0.00520000001, -0.0104),</span></div>
<div class="line">        <span class="comment">// Vec3d(73.0833969, -0.819999993, -2.02099991),</span></div>
<div class="line">        <span class="comment">// Vec3d(62.493, 0.425999999, -2.23099995),</span></div>
<div class="line">        <span class="comment">// Vec3d(50.4640007, 0.446999997, -2.32399988),</span></div>
<div class="line">        <span class="comment">// Vec3d(37.7970009, 0.0359999985, -1.29700005),</span></div>
<div class="line">        <span class="comment">// Vec3d(0, 0, 0),</span></div>
<div class="line">        <span class="comment">// Vec3d(51.5880013, 73.5179977, 51.5690002),</span></div>
<div class="line">        <span class="comment">// Vec3d(93.6989975, -15.7340002, 91.9420013),</span></div>
<div class="line">        <span class="comment">// Vec3d(69.4079971, -46.5940018, 50.4869995),</span></div>
<div class="line">        <span class="comment">// Vec3d(66.61000060000001, -13.6789999, -43.1720009),</span></div>
<div class="line">        <span class="comment">// Vec3d(11.7110004, 16.9799995, -37.1759987),</span></div>
<div class="line">        <span class="comment">// Vec3d(51.973999, 81.9440002, -8.40699959),</span></div>
<div class="line">        <span class="comment">// Vec3d(40.5489998, 50.4399986, 24.8490009),</span></div>
<div class="line">        <span class="comment">// Vec3d(60.8160019, 26.0690002, 49.4420013),</span></div>
<div class="line">        <span class="comment">// Vec3d(52.2529984, -19.9500008, -23.9960003),</span></div>
<div class="line">        <span class="comment">// Vec3d(51.2859993, 48.4700012, -15.0579996),</span></div>
<div class="line">        <span class="comment">// Vec3d(68.70700069999999, 12.2959995, 16.2129993),</span></div>
<div class="line">        <span class="comment">// Vec3d(63.6839981, 10.2930002, 16.7639999));</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// ColorCorrectionModel model8(src,ref,COLOR_SPACE_Lab_D50_2);</span></div>
<div class="line">        <span class="comment">// model8.run();</span></div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img_;</div>
<div class="line">        <a class="code hl_function" href="../../d8/d01/group__imgproc__color__conversions.html#gaf86c09fe702ed037c03c2bc603ceab14">cvtColor</a>(image, img_, COLOR_BGR2RGB);</div>
<div class="line">        img_.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(img_, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga30a562691cc5987bc88eb7bb7a8faf2b">CV_64F</a>);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> inp_size = 255;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> out_size = 255;</div>
<div class="line">        img_ = img_ / inp_size;</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> calibratedImage= model1.infer(img_);</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> out_ = calibratedImage * out_size;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Save the calibrated image to {FILE_NAME}.calibrated.{FILE_EXT}</span></div>
<div class="line">        out_.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(out_, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img_out = min(max(out_, 0), out_size);</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> out_img;</div>
<div class="line">        <a class="code hl_function" href="../../d8/d01/group__imgproc__color__conversions.html#gaf86c09fe702ed037c03c2bc603ceab14">cvtColor</a>(img_out, out_img, COLOR_RGB2BGR);</div>
<div class="line">        <span class="keywordtype">string</span> filename = filepath.substr(filepath.find_last_of(<span class="charliteral">&#39;/&#39;</span>)+1);</div>
<div class="line">        <span class="keywordtype">size_t</span> dotIndex = filename.find_last_of(<span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line">        <span class="keywordtype">string</span> baseName = filename.substr(0, dotIndex);</div>
<div class="line">        <span class="keywordtype">string</span> ext = filename.substr(dotIndex+1, filename.length()-dotIndex);</div>
<div class="line">        <span class="keywordtype">string</span> calibratedFilePath = baseName + <span class="stringliteral">&quot;.calibrated.&quot;</span> + ext;</div>
<div class="line">        <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">imwrite</a>(calibratedFilePath, out_img);</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="amcc_8hpp_html"><div class="ttname"><a href="../../df/d35/mcc_8hpp.html">mcc.hpp</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1936"></a>
Explanation</h1>
<p>The first part is to detect the ColorChecker position. </p><div class="fragment"><div class="line">    vector&lt;Ptr&lt;mcc::CChecker&gt;&gt; checkers = detector-&gt;getListColorChecker();</div>
</div><!-- fragment --> <div class="fragment"><div class="line">    <a class="code hl_class" href="../../d0/d2e/classcv_1_1CommandLineParser.html">CommandLineParser</a> parser(argc, argv, keys);</div>
<div class="line">    parser.about(about);</div>
<div class="line">    <span class="keywordflow">if</span> (argc==1 || parser.has(<span class="stringliteral">&quot;help&quot;</span>))</div>
<div class="line">    {</div>
<div class="line">        parser.printMessage();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> t = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;t&quot;</span>);</div>
<div class="line">    <span class="keywordtype">int</span> nc = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;nc&quot;</span>);</div>
<div class="line">    <span class="keywordtype">string</span> filepath = parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;f&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="../../db/de0/group__core__utils.html#gaf62bcd90f70e275191ab95136d85906b">CV_Assert</a>(0 &lt;= t &amp;&amp; t &lt;= 2);</div>
<div class="line">    <a class="code hl_enumeration" href="../../dd/d19/group__mcc.html#ga836ee96afcefd4f35e95760ca9e8163d">TYPECHART</a> chartType = <a class="code hl_enumeration" href="../../dd/d19/group__mcc.html#ga836ee96afcefd4f35e95760ca9e8163d">TYPECHART</a>(t);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!parser.check())</div>
<div class="line">    {</div>
<div class="line">        parser.printErrors();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> image = <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#gacbaa02cffc4ec2422dfa2e24412a99e2">imread</a>(filepath, IMREAD_COLOR);</div>
<div class="line">    <span class="keywordflow">if</span> (!image.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#a4d33bed1c850265370d2af0ff02e1564">data</a>)</div>
<div class="line">    {</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Invalid Image!&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
</div><!-- fragment --><p> Preparation for ColorChecker detection to get messages for the image.</p>
<div class="fragment"><div class="line">        <a class="code hl_typedef" href="../../dc/d84/group__core__basic.html#ga524e5e94ebf48db273a71ab275eaf5b5">Ptr&lt;CCheckerDraw&gt;</a> cdraw = CCheckerDraw::create(checker);</div>
<div class="line">        cdraw-&gt;draw(image);</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> chartsRGB = checker-&gt;getChartsRGB();</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> src = chartsRGB.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a23df02a07ffbfa4aa59c19bc003919fe">col</a>(1).<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a03d2a2570d06dcae378f788725789aa4">clone</a>().<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#a4eb96e3251417fa88b78e2abd6cfd7d8">reshape</a>(3, chartsRGB.<a class="code hl_variable" href="../../d3/d63/classcv_1_1Mat.html#abed816466c45234254d25bc59c31245e">rows</a>/3);</div>
<div class="line">        src /= 255.0;</div>
</div><!-- fragment --><p> The CCheckerDetectorobject is created and uses getListColorChecker function to get ColorChecker message.</p>
<div class="fragment"><div class="line">        ColorCorrectionModel model1(src, COLORCHECKER_Vinyl);</div>
<div class="line">        model1.run();</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> ccm = model1.getCCM();</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;ccm &quot;</span>&lt;&lt;ccm&lt;&lt;std::endl;</div>
<div class="line">        <span class="keywordtype">double</span> loss = model1.getLoss();</div>
<div class="line">        std::cout&lt;&lt;<span class="stringliteral">&quot;loss &quot;</span>&lt;&lt;loss&lt;&lt;std::endl;</div>
</div><!-- fragment --><p> For every ColorChecker, we can compute a ccm matrix for color correction. Model1 is an object of ColorCorrectionModel class. The parameters should be changed to get the best effect of color correction. See other parameters' detail at the Parameters.</p>
<div class="fragment"><div class="line">        <span class="comment">// cv::Mat ref = (Mat_&lt;Vec3d&gt;(18, 1) &lt;&lt;</span></div>
<div class="line">        <span class="comment">// Vec3d(100, 0.00520000001, -0.0104),</span></div>
<div class="line">        <span class="comment">// Vec3d(73.0833969, -0.819999993, -2.02099991),</span></div>
<div class="line">        <span class="comment">// Vec3d(62.493, 0.425999999, -2.23099995),</span></div>
<div class="line">        <span class="comment">// Vec3d(50.4640007, 0.446999997, -2.32399988),</span></div>
<div class="line">        <span class="comment">// Vec3d(37.7970009, 0.0359999985, -1.29700005),</span></div>
<div class="line">        <span class="comment">// Vec3d(0, 0, 0),</span></div>
<div class="line">        <span class="comment">// Vec3d(51.5880013, 73.5179977, 51.5690002),</span></div>
<div class="line">        <span class="comment">// Vec3d(93.6989975, -15.7340002, 91.9420013),</span></div>
<div class="line">        <span class="comment">// Vec3d(69.4079971, -46.5940018, 50.4869995),</span></div>
<div class="line">        <span class="comment">// Vec3d(66.61000060000001, -13.6789999, -43.1720009),</span></div>
<div class="line">        <span class="comment">// Vec3d(11.7110004, 16.9799995, -37.1759987),</span></div>
<div class="line">        <span class="comment">// Vec3d(51.973999, 81.9440002, -8.40699959),</span></div>
<div class="line">        <span class="comment">// Vec3d(40.5489998, 50.4399986, 24.8490009),</span></div>
<div class="line">        <span class="comment">// Vec3d(60.8160019, 26.0690002, 49.4420013),</span></div>
<div class="line">        <span class="comment">// Vec3d(52.2529984, -19.9500008, -23.9960003),</span></div>
<div class="line">        <span class="comment">// Vec3d(51.2859993, 48.4700012, -15.0579996),</span></div>
<div class="line">        <span class="comment">// Vec3d(68.70700069999999, 12.2959995, 16.2129993),</span></div>
<div class="line">        <span class="comment">// Vec3d(63.6839981, 10.2930002, 16.7639999));</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// ColorCorrectionModel model8(src,ref,COLOR_SPACE_Lab_D50_2);</span></div>
<div class="line">        <span class="comment">// model8.run();</span></div>
</div><!-- fragment --><p> If you use a customized ColorChecker, you can use your own reference color values and corresponding color space as shown above.</p>
<div class="fragment"><div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img_;</div>
<div class="line">        <a class="code hl_function" href="../../d8/d01/group__imgproc__color__conversions.html#gaf86c09fe702ed037c03c2bc603ceab14">cvtColor</a>(image, img_, COLOR_BGR2RGB);</div>
<div class="line">        img_.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(img_, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga30a562691cc5987bc88eb7bb7a8faf2b">CV_64F</a>);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> inp_size = 255;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> out_size = 255;</div>
<div class="line">        img_ = img_ / inp_size;</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> calibratedImage= model1.infer(img_);</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> out_ = calibratedImage * out_size;</div>
</div><!-- fragment --><p> The member function infer_image is to make correction correction using ccm matrix.</p>
<div class="fragment"><div class="line">        <span class="comment">// Save the calibrated image to {FILE_NAME}.calibrated.{FILE_EXT}</span></div>
<div class="line">        out_.<a class="code hl_function" href="../../d3/d63/classcv_1_1Mat.html#adf88c60c5b4980e05bb556080916978b">convertTo</a>(out_, <a class="code hl_define" href="../../d1/d1b/group__core__hal__interface.html#ga88c4cd9de76f678f33928ef1e3f96047">CV_8UC3</a>);</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> img_out = min(max(out_, 0), out_size);</div>
<div class="line">        <a class="code hl_class" href="../../d3/d63/classcv_1_1Mat.html">Mat</a> out_img;</div>
<div class="line">        <a class="code hl_function" href="../../d8/d01/group__imgproc__color__conversions.html#gaf86c09fe702ed037c03c2bc603ceab14">cvtColor</a>(img_out, out_img, COLOR_RGB2BGR);</div>
<div class="line">        <span class="keywordtype">string</span> filename = filepath.substr(filepath.find_last_of(<span class="charliteral">&#39;/&#39;</span>)+1);</div>
<div class="line">        <span class="keywordtype">size_t</span> dotIndex = filename.find_last_of(<span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line">        <span class="keywordtype">string</span> baseName = filename.substr(0, dotIndex);</div>
<div class="line">        <span class="keywordtype">string</span> ext = filename.substr(dotIndex+1, filename.length()-dotIndex);</div>
<div class="line">        <span class="keywordtype">string</span> calibratedFilePath = baseName + <span class="stringliteral">&quot;.calibrated.&quot;</span> + ext;</div>
<div class="line">        <a class="code hl_function" href="../../d4/da8/group__imgcodecs.html#ga8ac397bd09e48851665edbe12aa28f25">imwrite</a>(calibratedFilePath, out_img);</div>
</div><!-- fragment --><p> Save the calibrated image. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.12.0-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 8 2025 16:06:35 for OpenCV by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
